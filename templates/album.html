{% extends "base.html" %}
{% block content %}
    <div id="content"></div>
    <script type="text/javascript">
        $(document).ready( function(e) {
                $('#content').empty();
                var params = window.location.href;
                params = params.split("=")[1];
                var current_user = '';
                var owner = '';
                var pics = [];
                var access = '';
                var title = '';
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:3000/p2gkisj6/p3/api/v1/user',
                    success: function(data) {
                        data = data.data;
                        current_user = data.username;
                    },
                    error: function(errors) {
                        current_user = null;
                    }
                });
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:3000/p2gkisj6/p3/api/v1/album/' + params,
                    success: function(album) {
                        album = album.album;
                        owner = album.username;
                        pics = album.pics;
                        access = album.access;
                        title = album.title;
                    },
                    error: function(errors) {
                        str = JSON.parse(JSON.stringify(errors));
                        message = str.responseText;
                        message = JSON.parse(message);
                        message = message.errors[0].message;
                        status = str.status;
                        $('#content').append('<p class="error">' + message + '</div>')
                    },
                    complete: function(status) {
                        //check if private, if current user has access
                        if(status.status == 200){
                            $('#content').append('<p>' + title + ' by ' + owner + '</p>');
                            for(pic in pics){
                                $('#content').append('<div><a id="pic_' + pics[pic].picid + '_link" class="picture"><img src=/static/images/' + pics[pic].picid + '.' + pics[pic].format + ' height="75" width="75" display:"inline-block"></img></a><br>' + pics[pic].date + '<br>' + pics[pic].caption + '<br></div>')
                            }                    
                        }
                    }
                });
            });
            $('.picture').click( function() {
                $('.pictures').remove();
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:3000/p2gkisj6/p3/api/v1/pic',
                    success: function(data) {
                        data = data.data;
                        current_user = data.username;
                    },
                    error: function(errors) {
                        current_user = null;
                    }
                });
            });



            window.onpopstate = function(event) {
                document.getElementById("content").innerHTML = event.state.stateVariable;
            }

            var state1Obj = {stateVariable: "I am currently in state 1!"}
            var state2Obj = {stateVariable: "Now I am in state 2!"}
            var state3Obj = {stateVariable: "Now I am currently in state 3!"}
            history.replaceState(state3Obj, "title", "?state=3")
            history.pushState(state2Obj, "title", "?state=2")
            history.pushState(state1Obj, "title", "?state=1")

            document.getElementById("content").innerHTML = state1Obj.stateVariable
    </script>
{% endblock %}